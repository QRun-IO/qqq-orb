description: >
  Unified publishing job for all branch types
  Handles version management, building, testing, and publishing based on branch type
  Supports: snapshot, release_candidate, release (tagged), feature (tagged) and hotfix workflows

executor: java

parameters:
  java_version:
    type: string
    default: "21"
    description: "Java major version to install (e.g., '17', '21')"
  branch_type:
    type: string
    default: "snapshot"
    description: "Branch type: snapshot, release_candidate, release, features, or hotfix"
  check_middleware_api_versions:
    type: boolean
    default: false
    description: "Whether to run middleware API version checks"
  publish_asciidoc:
    type: boolean
    default: false
    description: "Whether to publish AsciiDoc documentation"

steps:
  - install_java:
      java_version: << parameters.java_version >>

  - git_full_checkout

  - mvn_build

  - mvn_manage_version

  - attach_workspace:
      at: .

  - mvn_verify

  - when:
      condition: << parameters.check_middleware_api_versions >>
      steps:
        - check_middleware_api_versions

  - mvn_jar_deploy

  - when:
      condition:
        not:
          equal: [ "<< parameters.branch_type >>", "feature" ]
      steps:
        - git_operations:
            branch_type: << parameters.branch_type >>

  - when:
      condition: << parameters.publish_asciidoc >>
      steps:
        - publish_asciidoc

  # GitHub releases only for final releases and hotfixes (not RCs)
  # RCs just publish artifacts - GitHub release happens when merged to main
  - when:
      condition:
        or:
          - equal: [ "<< parameters.branch_type >>", "release" ]
          - equal: [ "<< parameters.branch_type >>", "hotfix" ]
      steps:
        - publish_github_release:
            project_type: maven
