description: >
  Unified publishing job for all branch types
  Handles version management, building, testing, and publishing based on branch type
  Supports: snapshot, release_candidate, release, and hotfix workflows

executor:
  name: default
  tag: << parameters.node_version >>

parameters:
  node_version:
    type: string
    default: "lts"
    description: "Node.js version tag (e.g., 'lts', '18.0', '20.0')."
  branch_type:
    type: string
    default: "snapshot"
    description: "Branch type: snapshot, release_candidate, release, or hotfix"

steps:
  - git_full_checkout
  - node_install_dependencies
  - node_run_tests
  - node_manage_version:
      branch_type: << parameters.branch_type >>
  - attach_workspace:
      at: .
  - node_build_package
  - node_publish

  # GitHub releases only for final releases and hotfixes (not RCs)
  # RCs just publish artifacts - GitHub release happens when merged to main
  - when:
      condition:
        or:
          - equal: [ "<< parameters.branch_type >>", "release" ]
          - equal: [ "<< parameters.branch_type >>", "hotfix" ]
      steps:
        - publish_github_release:
            project_type: node
